FROM node:20-alpine

WORKDIR /liberwiki-frontend

ARG SENTRY_AUTH_TOKEN
ARG NEXT_PUBLIC_LIBERWIKI__NAME
ARG NEXT_PUBLIC_LIBERWIKI__DOMAIN
ARG NEXT_PUBLIC_LIBERWIKI__API__BASE_URL
ARG NEXT_PUBLIC_LIBERWIKI__LANGUAGE
ARG NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__DSN
ARG NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__TRACES_SAMPLE_RATE
ARG NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_SESSION_SAMPLE_RATE
ARG NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_ON_ERROR_SAMPLE_RATE
ARG NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__GOOGLE_ANALYTICS__GA_ID

ENV SENTRY_AUTH_TOKEN=$SENTRY_AUTH_TOKEN
ENV NEXT_PUBLIC_LIBERWIKI__NAME=$NEXT_PUBLIC_LIBERWIKI__NAME
ENV NEXT_PUBLIC_LIBERWIKI__DOMAIN=$NEXT_PUBLIC_LIBERWIKI__DOMAIN
ENV NEXT_PUBLIC_LIBERWIKI__API__BASE_URL=$NEXT_PUBLIC_LIBERWIKI__API__BASE_URL
ENV NEXT_PUBLIC_LIBERWIKI__LANGUAGE=$NEXT_PUBLIC_LIBERWIKI__LANGUAGE
ENV NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__DSN=$NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__DSN
ENV NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__TRACES_SAMPLE_RATE=$NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__TRACES_SAMPLE_RATE
ENV NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_SESSION_SAMPLE_RATE=$NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_SESSION_SAMPLE_RATE
ENV NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_ON_ERROR_SAMPLE_RATE=$NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__SENTRY__REPLAYS_ON_ERROR_SAMPLE_RATE
ENV NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__GOOGLE_ANALYTICS__GA_ID=$NEXT_PUBLIC_LIBERWIKI__FRONT_END__DEVTOOLS__GOOGLE_ANALYTICS__GA_ID

COPY . /liberwiki-frontend/

RUN npm install --frozen-lockfile
RUN npm run build

ENV NODE_ENV=production

EXPOSE 3000

RUN chmod +x /liberwiki-frontend/entrypoint.sh
ENTRYPOINT ["/liberwiki-frontend/entrypoint.sh"]
